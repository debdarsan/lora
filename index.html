<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Anxiety Helper - AI-Powered</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: transparent;
            border: none;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        .tab-content {
            display: none;
            padding: 20px;
            animation: fadeIn 0.3s;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* keeping all CSS intact, unchanged */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ§  Anxiety Helper</h1>
            <p>AI-Powered Symptom Matching & Support</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(event, 'voice')">Voice Input</button>
            <button class="tab" onclick="switchTab(event, 'history')">History</button>
            <button class="tab" onclick="switchTab(event, 'database')">Database</button>
            <button class="tab" onclick="switchTab(event, 'settings')">Settings</button>
        </div>

        <div id="voice" class="tab-content active">
            <div id="resultSection" style="display: none;">
                <div class="result-card">
                    <h3>Analysis Results</h3>
                    <p><span class="label">Matched Symptom:</span><span id="matchedSymptom"></span></p>
                    <p><span class="label">Confidence Score:</span><span id="confidenceScore"></span></p>
                    <div class="confidence-meter">
                        <div class="confidence-fill" id="confidenceFill"></div>
                    </div>
                    <div id="aiReasoning" class="ai-reasoning" style="display: none;">
                        <strong>AI Reasoning:</strong> <span id="reasoningText"></span>
                    </div>
                    <p><span class="label">NLP Conflict:</span><span id="nlpConflict"></span></p>
                    <p><span class="label">Prevention Technique:</span></p>
                    <p id="preventionText" style="background: white; padding: 10px; border-radius: 5px; margin-top: 5px;"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // âœ… Full anxiety symptom database
        const anxietyDatabase = [
            {
                symptom: "Racing heart or palpitations",
                keywords: ["heart", "racing", "palpitations", "heartbeat", "pulse", "chest", "pounding", "fast heart", "rapid heartbeat"],
                prevention: "Practice deep breathing exercises: Inhale for 4 counts, hold for 4, exhale for 6. Repeat 5-10 times. Consider regular cardio exercise to improve heart rate variability.",
                nlpConflict: "Physical sensations vs. safety beliefs"
            },
            {
                symptom: "Difficulty breathing or shortness of breath",
                keywords: ["breathing", "breath", "breathless", "air", "suffocating", "can't breathe", "shortness", "gasping", "hyperventilating", "tight chest"],
                prevention: "Use the 5-4-3-2-1 grounding technique: Name 5 things you see, 4 you can touch, 3 you hear, 2 you smell, 1 you taste. Practice diaphragmatic breathing daily.",
                nlpConflict: "Control vs. surrender patterns"
            },
            {
                symptom: "Excessive worry about the future",
                keywords: ["worry", "future", "anxious", "concerned", "overthinking", "what if", "scared", "tomorrow", "next week"],
                prevention: "Set a 'worry window' - dedicate 15 minutes daily to process worries, then redirect thoughts. Practice mindfulness meditation focusing on present moment awareness.",
                nlpConflict: "Future projection vs. present reality"
            },
            {
                symptom: "Feeling overwhelmed or out of control",
                keywords: ["overwhelmed", "control", "too much", "can't handle", "stressed", "pressure", "chaos", "losing it"],
                prevention: "Break tasks into smaller steps. Create a priority matrix: urgent/important quadrants. Practice the STOP technique: Stop, Take a breath, Observe, Proceed mindfully.",
                nlpConflict: "All-or-nothing thinking patterns"
            },
            {
                symptom: "Trouble sleeping or insomnia",
                keywords: ["sleep", "insomnia", "can't sleep", "awake", "tired", "restless nights", "tossing turning"],
                prevention: "Establish a wind-down routine 1 hour before bed. No screens, practice progressive muscle relaxation. Keep a worry journal beside your bed to offload thoughts.",
                nlpConflict: "Active mind vs. rest needs"
            },
            {
                symptom: "Muscle tension or body aches",
                keywords: ["tension", "muscle", "tight", "ache", "pain", "stiff", "sore", "shoulders", "neck", "back"],
                prevention: "Practice progressive muscle relaxation: Tense and release each muscle group for 5 seconds. Consider yoga or gentle stretching. Take magnesium supplements after consulting a doctor.",
                nlpConflict: "Holding vs. releasing patterns"
            },
            {
                symptom: "Difficulty concentrating or mind going blank",
                keywords: ["concentrate", "focus", "blank", "mind", "distracted", "foggy", "can't think", "forget"],
                prevention: "Use the Pomodoro Technique: 25 minutes focus, 5 minute break. Practice single-tasking. Try brain-training exercises or puzzles to improve cognitive flexibility.",
                nlpConflict: "Mental overload vs. clarity needs"
            },
            {
                symptom: "Irritability or restlessness",
                keywords: ["irritable", "angry", "restless", "agitated", "annoyed", "frustrated", "on edge", "snappy", "fidgety"],
                prevention: "Engage in physical activity to release tension. Practice self-compassion exercises. Set clear boundaries and communicate needs assertively.",
                nlpConflict: "Internal pressure vs. external demands"
            },
            {
                symptom: "Avoiding social situations",
                keywords: ["avoiding", "social", "isolation", "alone", "withdraw", "hide", "people", "crowds", "parties"],
                prevention: "Start with small, manageable social goals. Practice self-compassion. Prepare conversation starters. Use the 3-3-3 rule: name 3 things you see, hear, and can move.",
                nlpConflict: "Safety vs. connection needs"
            },
            {
                symptom: "Panic attacks or sudden fear",
                keywords: ["panic", "attack", "fear", "terror", "dying", "losing control", "sudden", "intense", "scared"],
                prevention: "Learn to recognize early warning signs. Practice TIPP: Temperature change, Intense exercise, Paced breathing, Paired muscle relaxation. Create a panic attack action plan.",
                nlpConflict: "Fight-or-flight vs. actual threat"
            },
            {
                symptom: "Constant fatigue or exhaustion",
                keywords: ["tired", "fatigue", "exhausted", "no energy", "drained", "worn out", "weak", "sleepy", "lethargic"],
                prevention: "Maintain consistent sleep schedule. Limit caffeine intake. Practice energy management: match activities to energy levels. Consider vitamin D and B12 levels check.",
                nlpConflict: "Hypervigilance vs. rest requirements"
            },
            {
                symptom: "Digestive issues or stomach problems",
                keywords: ["stomach", "digestive", "nausea", "sick", "belly", "gut", "bathroom", "upset stomach", "butterflies"],
                prevention: "Practice mindful eating. Reduce caffeine and alcohol. Try gut-friendly foods: probiotics, fiber. Consider the gut-brain connection through vagus nerve exercises.",
                nlpConflict: "Gut feelings vs. mental processing"
            },
            {
                symptom: "Sweating or trembling",
                keywords: ["sweating", "sweat", "trembling", "shaking", "tremor", "hot", "cold", "clammy", "shivering"],
                prevention: "Keep cooling aids handy. Practice acceptance of physical symptoms. Use positive self-talk. Consider beta-blockers for performance anxiety (consult doctor).",
                nlpConflict: "Visibility fears vs. authenticity"
            },
            {
                symptom: "Fear of losing control or going crazy",
                keywords: ["crazy", "losing mind", "going mad", "insane", "losing it", "breakdown", "snap", "psychotic", "unreal"],
                prevention: "Remind yourself: anxiety is uncomfortable but not dangerous. Practice reality testing. Keep a symptom diary to identify patterns. Seek professional support.",
                nlpConflict: "Catastrophic thinking vs. reality"
            },
            {
                symptom: "Perfectionism or fear of making mistakes",
                keywords: ["perfect", "mistakes", "failure", "wrong", "not good enough", "mess up", "disappoint", "standards"],
                prevention: "Set 'good enough' standards. Practice deliberate imperfection. Celebrate small wins. Use the 80/20 rule: 80% perfect is often sufficient.",
                nlpConflict: "Ideal self vs. human self"
            }
        ];

        let apiKey = '';
        let recognition = null;
        let synthesis = window.speechSynthesis;

        // GPT refine prevention
        async function gptRefinePrevention(preventionText, userInput) {
            if (!apiKey) return preventionText;
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            { role: 'system', content: 'You are a mental health assistant. Suggest concise, safe, practical prevention strategies. Avoid medical prescriptions.' },
                            { role: 'user', content: `User described symptoms as: "${userInput}". The app suggests this prevention: "${preventionText}". Please provide a refined prevention strategy in 3-5 sentences.` }
                        ]
                    })
                });
                if (!response.ok) return preventionText;
                const data = await response.json();
                return data.choices[0].message.content.trim();
            } catch {
                return preventionText;
            }
        }

        // Display result with GPT refined prevention
        async function displayResult(match, userInput) {
            document.getElementById('matchedSymptom').textContent = match.item.symptom;
            document.getElementById('nlpConflict').textContent = match.item.nlpConflict;
            const refined = await gptRefinePrevention(match.item.prevention, userInput);
            document.getElementById('preventionText').textContent = refined;
            const utter = new SpeechSynthesisUtterance(refined);
            synthesis.speak(utter);
        }

        async function processSymptoms(userInput) {
            // dummy pick first
            const match = { item: anxietyDatabase[0], score: 1.0 };
            await displayResult(match, userInput);
        }
    </script>
</body>
</html>
